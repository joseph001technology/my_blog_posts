{% extends 'blogtemplates/base.html' %}

{% block title %}
  Search Page
{% endblock %}

{% block content %}
<div class="container mt-4">
    {% if q %}
        <h2>Search results for "{{ q }}" {% if c %} in category "{{ c }}" {% endif %}</h2>
        <p>
            {% with results.count as total_results %}
                Found {{ total_results }} result{{ total_results|pluralize }}
            {% endwith %}
        </p>

        <div class="post-grid mt-4">
            {% for post in results %}
                <div class="card mb-3 single-post-container">
                    <div class="card-body">
                        <h4 class="card-title">
                            <a href="{% url 'blog:post_single' post.slug %}" class="text-decoration-none text-dark">
                                {{ post.title }}
                            </a>
                        </h4>

                        <h6 class="card-subtitle mb-2 text-muted">
                            by {{ post.author }} |
                            Published on {{ post.published_at|date:"F j, Y" }}
                        </h6>

                        {% if post.image %}
                            <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid rounded mb-2" style="max-height: 300px;">
                        {% endif %}

                        {% if post.excerpt %}
                            <p class="card-text">{{ post.excerpt|truncatechars:100 }}</p>
                        {% else %}
                            <p class="card-text">{{ post.content|truncatewords:30 }}</p>
                        {% endif %}

                        <a href="{% url 'blog:post_single' post.slug %}" class="btn btn-sm btn-outline-primary mt-2 explore-btn">Read More</a>
                    </div>
                </div>
            {% empty %}
                <p>No results found for your query.</p>
            {% endfor %}
        </div>

        <a href="{% url 'blog:post_search' %}" class="btn btn-primary mt-4 explore-btn">New Search</a>
        <div class="mt-5">
             <a href="{% url 'blog:homepage' %}" class="btn btn-secondary explore-btn">← Back to Home</a>
        </div>

    {% else %}
        <h2>Search for posts</h2>
        <form method="get" class="mt-3">
            {{ form.as_p }}
            <button class="btn btn-primary explore-btn" type="submit">Search</button>
        </form>
        <div class="mt-5">
            <a href="{% url 'blog:homepage' %}" class="btn btn-secondary explore-btn">← Back to Home</a>
        </div>
    {% endif %}
</div>
{% endblock %}
